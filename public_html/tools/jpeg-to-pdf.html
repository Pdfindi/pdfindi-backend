<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JPEG to PDF - PDFINDI</title>
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <style>
        .tool-page {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .tool-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }
        .tool-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #e74c3c;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: color 0.3s;
        }
        .back-btn:hover {
            color: #c0392b;
        }
        .upload-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 2rem;
        }
        .upload-zone:hover {
            border-color: #e74c3c;
            background: #fff5f5;
        }
        .upload-zone.dragover {
            border-color: #28a745;
            background: #f0fff4;
        }
        .upload-icon {
            font-size: 3rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        .images-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
            display: none;
        }
        .image-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        .image-thumbnail {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        .image-info {
            padding: 0.5rem;
            font-size: 0.8rem;
            background: #f8f9fa;
        }
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pdf-settings {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 2rem 0;
            display: none;
        }
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .setting-group label {
            font-weight: 600;
            color: #495057;
        }
        .page-layout {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }
        .layout-option {
            flex: 1;
            padding: 1rem;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .layout-option:hover {
            border-color: #e74c3c;
        }
        .layout-option.selected {
            border-color: #e74c3c;
            background: #fff5f5;
        }
        .processing {
            text-align: center;
            padding: 2rem;
            display: none;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e74c3c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .download-section {
            text-align: center;
            margin: 2rem 0;
            display: none;
        }
        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin: 0.5rem;
        }
        .download-btn:hover {
            background: #218838;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 1rem 0;
            display: none;
        }
        .sortable-list {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .image-sort-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin: 0.5rem 0;
            cursor: move;
            background: white;
        }
        .image-sort-item:hover {
            background: #f8f9fa;
        }
        .drag-handle {
            cursor: grab;
            font-size: 1.2rem;
            color: #6c757d;
        }
        .sort-thumbnail {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
        }
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            .page-layout {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="tool-page">
        <a href="../index.html" class="back-btn">
            ‚Üê Back to Tools
        </a>
        
        <div class="tool-header">
            <div class="tool-icon">üñºÔ∏è</div>
            <h1>JPEG to PDF</h1>
            <p>Convert multiple JPG/PNG images into a single PDF document</p>
        </div>

        <div class="upload-zone" id="upload-zone">
            <div class="upload-icon">üì∑</div>
            <h3>Click to upload or drag & drop images</h3>
            <p>Supports JPG, PNG, GIF, WebP images</p>
            <input type="file" id="file-input" accept="image/*" multiple style="display: none;">
        </div>

        <div class="error-message" id="error-message"></div>

        <div class="images-preview" id="images-preview"></div>

        <div class="pdf-settings" id="pdf-settings">
            <h3>PDF Settings</h3>
            <div class="settings-grid">
                <div class="setting-group">
                    <label for="page-size">Page Size:</label>
                    <select id="page-size">
                        <option value="a4">A4 (210 √ó 297 mm)</option>
                        <option value="letter">Letter (8.5 √ó 11 in)</option>
                        <option value="a3">A3 (297 √ó 420 mm)</option>
                        <option value="a5">A5 (148 √ó 210 mm)</option>
                        <option value="custom">Fit to Image</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="orientation">Orientation:</label>
                    <select id="orientation">
                        <option value="auto">Auto (based on image)</option>
                        <option value="portrait">Portrait</option>
                        <option value="landscape">Landscape</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="margin">Margin:</label>
                    <select id="margin">
                        <option value="0">No Margin</option>
                        <option value="10">Small (10px)</option>
                        <option value="20" selected>Medium (20px)</option>
                        <option value="40">Large (40px)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="quality">Image Quality:</label>
                    <select id="quality">
                        <option value="0.6">Good (smaller file)</option>
                        <option value="0.8" selected>High</option>
                        <option value="0.9">Best (larger file)</option>
                        <option value="1.0">Original</option>
                    </select>
                </div>
            </div>

            <h4 style="margin-top: 1.5rem;">Layout Options</h4>
            <div class="page-layout">
                <div class="layout-option selected" data-layout="single">
                    <strong>One Image per Page</strong>
                    <p>Each image on separate page</p>
                </div>
                <div class="layout-option" data-layout="multiple">
                    <strong>Multiple Images per Page</strong>
                    <p>Fit multiple small images on one page</p>
                </div>
            </div>

            <div class="sortable-list" id="sortable-list" style="display: none;">
                <h4>Reorder Images (drag to reorder):</h4>
                <div id="sort-items"></div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="red-button" id="create-pdf-btn">üìÑ Create PDF</button>
            </div>
        </div>

        <div class="processing" id="processing">
            <div class="spinner"></div>
            <p id="processing-text">Creating PDF...</p>
        </div>

        <div class="download-section" id="download-section">
            <h3>‚úÖ PDF Created Successfully!</h3>
            <p id="pdf-info">Your PDF is ready for download</p>
            <button class="download-btn" id="download-btn">üì• Download PDF</button>
            <button class="red-button" id="create-new-btn">üîÑ Create Another PDF</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script>
        let selectedImages = [];
        let pdfBlob = null;

        const elements = {
            uploadZone: document.getElementById('upload-zone'),
            fileInput: document.getElementById('file-input'),
            errorMessage: document.getElementById('error-message'),
            imagesPreview: document.getElementById('images-preview'),
            pdfSettings: document.getElementById('pdf-settings'),
            pageSizeSelect: document.getElementById('page-size'),
            orientationSelect: document.getElementById('orientation'),
            marginSelect: document.getElementById('margin'),
            qualitySelect: document.getElementById('quality'),
            layoutOptions: document.querySelectorAll('.layout-option'),
            sortableList: document.getElementById('sortable-list'),
            sortItems: document.getElementById('sort-items'),
            createPdfBtn: document.getElementById('create-pdf-btn'),
            processing: document.getElementById('processing'),
            processingText: document.getElementById('processing-text'),
            downloadSection: document.getElementById('download-section'),
            pdfInfo: document.getElementById('pdf-info'),
            downloadBtn: document.getElementById('download-btn'),
            createNewBtn: document.getElementById('create-new-btn')
        };

        function showError(message) {
            elements.errorMessage.textContent = message;
            elements.errorMessage.style.display = 'block';
            setTimeout(() => {
                elements.errorMessage.style.display = 'none';
            }, 5000);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function handleFileSelect(files) {
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showError(`${file.name} is not a valid image file.`);
                    return;
                }

                if (file.size > 10 * 1024 * 1024) { // 10MB limit per image
                    showError(`${file.name} is too large. Please use images under 10MB.`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageData = {
                        id: Date.now() + Math.random(),
                        file: file,
                        dataUrl: e.target.result,
                        name: file.name,
                        size: file.size
                    };
                    selectedImages.push(imageData);
                    updateImagesPreview();
                };
                reader.readAsDataURL(file);
            });
        }

        function updateImagesPreview() {
            if (selectedImages.length === 0) {
                elements.imagesPreview.style.display = 'none';
                elements.pdfSettings.style.display = 'none';
                return;
            }

            elements.imagesPreview.style.display = 'grid';
            elements.pdfSettings.style.display = 'block';

            elements.imagesPreview.innerHTML = '';
            selectedImages.forEach(image => {
                const item = document.createElement('div');
                item.className = 'image-item';
                item.innerHTML = `
                    <img src="${image.dataUrl}" alt="${image.name}" class="image-thumbnail">
                    <div class="image-info">
                        <div style="font-weight: 600; margin-bottom: 2px;">${image.name}</div>
                        <div>${formatFileSize(image.size)}</div>
                    </div>
                    <button class="remove-image" onclick="removeImage('${image.id}')">√ó</button>
                `;
                elements.imagesPreview.appendChild(item);
            });

            updateSortableList();
        }

        function updateSortableList() {
            if (selectedImages.length > 1) {
                elements.sortableList.style.display = 'block';
                elements.sortItems.innerHTML = '';
                
                selectedImages.forEach((image, index) => {
                    const item = document.createElement('div');
                    item.className = 'image-sort-item';
                    item.draggable = true;
                    item.dataset.imageId = image.id;
                    item.innerHTML = `
                        <span class="drag-handle">‚ãÆ‚ãÆ</span>
                        <img src="${image.dataUrl}" alt="${image.name}" class="sort-thumbnail">
                        <span style="flex: 1;">${image.name}</span>
                        <span>${index + 1}</span>
                    `;
                    elements.sortItems.appendChild(item);
                });

                // Add drag and drop functionality
                addSortableEvents();
            } else {
                elements.sortableList.style.display = 'none';
            }
        }

        function addSortableEvents() {
            const items = elements.sortItems.querySelectorAll('.image-sort-item');
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', item.dataset.imageId);
                    item.style.opacity = '0.5';
                });

                item.addEventListener('dragend', () => {
                    item.style.opacity = '1';
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const draggedId = e.dataTransfer.getData('text/plain');
                    const droppedId = item.dataset.imageId;
                    
                    if (draggedId !== droppedId) {
                        reorderImages(draggedId, droppedId);
                    }
                });
            });
        }

        function reorderImages(draggedId, droppedId) {
            const draggedIndex = selectedImages.findIndex(img => img.id == draggedId);
            const droppedIndex = selectedImages.findIndex(img => img.id == droppedId);
            
            const draggedImage = selectedImages.splice(draggedIndex, 1)[0];
            selectedImages.splice(droppedIndex, 0, draggedImage);
            
            updateSortableList();
        }

        function removeImage(id) {
            selectedImages = selectedImages.filter(img => img.id != id);
            updateImagesPreview();
        }

        async function createPDF() {
            if (selectedImages.length === 0) {
                showError('Please select at least one image.');
                return;
            }

            elements.processing.style.display = 'block';
            elements.processingText.textContent = 'Creating PDF...';

            try {
                const pdfDoc = await PDFLib.PDFDocument.create();
                const pageSize = elements.pageSizeSelect.value;
                const orientation = elements.orientationSelect.value;
                const margin = parseInt(elements.marginSelect.value);
                const quality = parseFloat(elements.qualitySelect.value);
                const layout = document.querySelector('.layout-option.selected').dataset.layout;

                // Page dimensions
                const pageSizes = {
                    a4: { width: 595, height: 842 },
                    letter: { width: 612, height: 792 },
                    a3: { width: 842, height: 1191 },
                    a5: { width: 420, height: 595 }
                };

                for (let i = 0; i < selectedImages.length; i++) {
                    elements.processingText.textContent = `Processing image ${i + 1} of ${selectedImages.length}...`;
                    
                    const image = selectedImages[i];
                    let pdfImage;

                    // Embed image in PDF
                    if (image.file.type === 'image/jpeg') {
                        pdfImage = await pdfDoc.embedJpg(await image.file.arrayBuffer());
                    } else {
                        pdfImage = await pdfDoc.embedPng(await convertToPng(image.dataUrl));
                    }

                    const { width: imgWidth, height: imgHeight } = pdfImage;
                    let pageWidth, pageHeight;

                    if (pageSize === 'custom') {
                        // Fit page to image
                        pageWidth = imgWidth + (margin * 2);
                        pageHeight = imgHeight + (margin * 2);
                    } else {
                        const size = pageSizes[pageSize];
                        
                        // Determine orientation
                        if (orientation === 'auto') {
                            if (imgWidth > imgHeight) {
                                pageWidth = Math.max(size.width, size.height);
                                pageHeight = Math.min(size.width, size.height);
                            } else {
                                pageWidth = Math.min(size.width, size.height);
                                pageHeight = Math.max(size.width, size.height);
                            }
                        } else if (orientation === 'landscape') {
                            pageWidth = Math.max(size.width, size.height);
                            pageHeight = Math.min(size.width, size.height);
                        } else {
                            pageWidth = Math.min(size.width, size.height);
                            pageHeight = Math.max(size.width, size.height);
                        }
                    }

                    const page = pdfDoc.addPage([pageWidth, pageHeight]);

                    // Calculate image dimensions to fit on page
                    const maxWidth = pageWidth - (margin * 2);
                    const maxHeight = pageHeight - (margin * 2);
                    
                    let scaledWidth = imgWidth;
                    let scaledHeight = imgHeight;
                    
                    if (scaledWidth > maxWidth) {
                        const scale = maxWidth / scaledWidth;
                        scaledWidth = maxWidth;
                        scaledHeight = scaledHeight * scale;
                    }
                    
                    if (scaledHeight > maxHeight) {
                        const scale = maxHeight / scaledHeight;
                        scaledHeight = maxHeight;
                        scaledWidth = scaledWidth * scale;
                    }

                    // Center image on page
                    const x = (pageWidth - scaledWidth) / 2;
                    const y = (pageHeight - scaledHeight) / 2;

                    page.drawImage(pdfImage, {
                        x: x,
                        y: y,
                        width: scaledWidth,
                        height: scaledHeight
                    });
                }

                elements.processingText.textContent = 'Finalizing PDF...';
                const pdfBytes = await pdfDoc.save();
                pdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });

                elements.processing.style.display = 'none';
                elements.pdfInfo.textContent = `PDF created with ${selectedImages.length} image(s) ‚Ä¢ ${formatFileSize(pdfBlob.size)}`;
                elements.downloadSection.style.display = 'block';

            } catch (error) {
                console.error('Error creating PDF:', error);
                showError('Failed to create PDF. Please try again.');
                elements.processing.style.display = 'none';
            }
        }

        async function convertToPng(dataUrl) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    canvas.toBlob((blob) => {
                        blob.arrayBuffer().then(resolve);
                    }, 'image/png');
                };
                
                img.src = dataUrl;
            });
        }

        function downloadPDF() {
            if (!pdfBlob) return;

            const url = URL.createObjectURL(pdfBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `images-to-pdf-${Date.now()}.pdf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function resetTool() {
            selectedImages = [];
            pdfBlob = null;
            
            elements.imagesPreview.style.display = 'none';
            elements.pdfSettings.style.display = 'none';
            elements.downloadSection.style.display = 'none';
            elements.processing.style.display = 'none';
            
            // Reset to defaults
            elements.pageSizeSelect.value = 'a4';
            elements.orientationSelect.value = 'auto';
            elements.marginSelect.value = '20';
            elements.qualitySelect.value = '0.8';
            
            document.querySelectorAll('.layout-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.layout === 'single') {
                    option.classList.add('selected');
                }
            });
        }

        // Event listeners
        elements.uploadZone.addEventListener('click', () => elements.fileInput.click());

        elements.uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.add('dragover');
        });

        elements.uploadZone.addEventListener('dragleave', () => {
            elements.uploadZone.classList.remove('dragover');
        });

        elements.uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files);
            }
        });

        elements.fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files);
            }
        });

        elements.layoutOptions.forEach(option => {
            option.addEventListener('click', () => {
                elements.layoutOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
            });
        });

        elements.createPdfBtn.addEventListener('click', createPDF);
        elements.downloadBtn.addEventListener('click', downloadPDF);
        elements.createNewBtn.addEventListener('click', resetTool);

        // Make removeImage function global
        window.removeImage = removeImage;
    </script>
</body>
</html>
